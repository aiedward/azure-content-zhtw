<properties
   pageTitle="適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware | Microsoft Azure"
   description="本文提供適用於 Azure 的 Microsoft Antimalware 架構概觀，其中包括支援的案例和針對 Azure 雲端服務和虛擬機器啟用、設定及部署保護的設定。我們將涵蓋可透過 Microsoft Azure 服務管理 API、PowerShell 指令碼、Azure 入口網站及 Visual Studio 來存取的基本組態、管理和監視功能。"
   services="security"
   documentationCenter="na"
   authors="YuriDio"
   manager="swadhwa"
   editor=""/>

<tags
   ms.service="security"
   ms.devlang="na"
   ms.topic="article"
   ms.tgt_pltfrm="na"
   ms.workload="na"
   ms.date="09/19/2016"
   ms.author="yurid"/>

#適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware

現今雲端環境的威脅型態非常多變，因此企業 IT 雲端訂閱者為了遵循法規與達到安全性需求，在維護有效保護機制方面承受許多壓力。「適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware」是一項免費的即時保護功能，能夠協助識別並移除病毒、間諜軟體及其他惡意軟體，且具有可設定的警示，可在已知的惡意或垃圾軟體嘗試在您的 Azure 系統上安裝或執行時發出警示。

此解決方案其建置的反惡意程式碼平台與 Microsoft Security Essentials [MSE]、Microsoft Forefront Endpoint Protection、Microsoft System Center Endpoint Protection、Windows Intune 及適用於 Windows 8.0 和更新版本的 Windows Defender 所使用的平台相同。適用於 Azure 的 Microsoft Antimalware 是一個針對應用程式和租用戶環境所提供的單一代理程式解決方案，其設計可於無人為介入的情況下在背景中執行。您可依據應用程式工作負載需求，選擇預設的基本安全性或進階的自訂組態 (包括反惡意程式碼監視) 來部署保護。

當您為應用程式部署並啟用適用於 Azure 的 Microsoft Antimalware 時，有下列幾項核心功能可供使用：

- **即時保護** - 監視雲端服務和虛擬機器上的活動，以偵測和封鎖惡意程式碼執行。
- **排程掃描** - 定期執行目標掃描以偵測惡意程式碼，包括主動執行程式。
- **惡意程式碼補救** - 自動針對偵測到的惡意程式碼採取行動，例如刪除或隔離惡意檔案及清除惡意的登錄項目。
- **簽章更新** - 自動安裝最新的保護簽章 (病毒定義) 以確保依預定頻率維持最新的保護狀態。
- **Antimalware 引擎更新** – 自動更新 Microsoft Antimalware 引擎。
- **Antimalware 平台更新** – 自動更新 Microsoft Antimalware 平台。
- **主動保護** - 將有關偵測到的威脅和可疑資源的遙測中繼資料報告至 Microsoft Azure，以確保能針對不斷演變的威脅型態做出快速的回應，並可透過 Microsoft Active Protection System (MAPS) 啟用即時的同步簽章傳遞。
- **範例報告** - 將範例提供並報告至 Microsoftt Antimalware 服務，以協助改善其服務並啟用疑難排解。
- **排除項目** – 可讓應用程式和服務管理員設定特定的檔案、處理序及磁碟機，以因應效能及/或其他原因將其從保護和掃描中排除。
- **事件收集** -記錄作業系統事件記錄檔中反惡意程式碼服務的健康狀況、可疑的活動及其所採取的補救動作，並將這些資料收集至客戶的 Azure 儲存體帳戶。

> [AZURE.NOTE] 您也可以使用「Azure 資訊安全中心」來部署 Microsoft Antimalware。如需詳細資訊，請參閱[在 Azure 資訊安全中心安裝端點保護](../security-center/security-center-install-endpoint-protection.md)。

##架構

「適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware」解決方案包含「Microsoft Antimalware 用戶端和服務」、Antimalware 傳統部署模型、Antimalware PowerShell Cmdlet 及「Azure 診斷延伸模組」。Windows Server 2008 R2、Windows Server 2012 和 Windows Server 2012 R2 作業系統系列可支援 Microsoft Antimalware 解決方案。Windows Server 2008 作業系統則不支援此解決方案。目前仍不支援 Windows Server Technical Preview，但是我們打算日後提供其支援服務。

「Microsoft Antimalware 用戶端和服務」預設是以停用狀態安裝在「雲端服務」平台中所有支援的 Azure 客體作業系統系列上。「Microsoft Antimalware 用戶端和服務」預設不會安裝在「虛擬機器」平台中，而是在 Azure 入口網站及「Visual Studio 虛擬機器」組態的 [安全性擴充功能] 底下作為一項選擇性功能。

使用 Azure 網站時，裝載 Web 應用程式的基礎伺服器會啟用 Microsoft Antimalware。這是用來保護 Azure 網站基礎結構，而並不會對客戶內容執行。


###Microsoft Antimalware 工作流程

Azure 服務系統管理員可針對您的虛擬機器和雲端服務，使用預設或自訂組態來啟用 Azure 的 Antimalware，可用選項如下：

-   虛擬機器 – 在 Azure 入口網站中的 [安全性擴充功能] 底下

-   虛擬機器 – 在伺服器瀏覽器中使用 Visual Studio 虛擬機器組態

-   虛擬機器和雲端服務 – 使用 Antimalware [傳統部署模型](https://msdn.microsoft.com/library/azure/ee460799.aspx)

-   虛擬機器和雲端服務 – 使用 Antimalware PowerShell Cmdlet

Azure 入口網站或 PowerShell Cmdlet 會將 Antimalware 延伸模組封裝檔案推送至 Azure 系統中的預定固定位置。Azure 客體代理程式 (或網狀架構代理程式) 會啟動反惡意程式碼延伸模組，將提供的反惡意程式碼組態設定套用為輸入。這個步驟可讓您以預設或自訂組態設定來啟動反惡意程式碼服務。若未提供任何自訂組態，則將以預設組態設定來啟用反惡意程式碼服務。如需詳細資訊，請參閱[適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware – 程式碼範例](http://aka.ms/amazsamples "適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware 程式碼範例")中的*Antimalware 組態*一節。

一旦執行時，Microsoft Antimalware 用戶端會從網際網路下載最新的保護引擎和簽章定義並將其載入 Azure 系統上。Microsoft Antimalware 服務會將服務相關事件寫入至 Microsoft Antimalware 事件來源下的系統 OS 事件記錄檔中。事件包括反惡意程式碼用戶端健康狀態、保護和補救狀態、新的和舊的組態設定、引擎更新和簽章定義及其他資訊。

您可以啟用雲端服務或虛擬機器的反惡意程式碼監視，以便在反惡意程式碼事件記錄檔事件產生至您的 Azure 儲存體帳戶時一同寫入。反惡意程式碼服務會使用 Azure 診斷延伸模組將 Azure 系統中的反惡意程式碼事件收集至客戶的 Azure 儲存體帳戶中的資料表。

支援上述案例的部署工作流程，包括組態步驟和選項都記載於本文中的 [Antimalware 部署案例](#_Antimalware_Deployment_Scenarios)一節中。

![Azure 中的 Microsoft Antimalware](./media/azure-security-antimalware/sec-azantimal-fig1.PNG)

> [AZURE.NOTE] 不過，您可以使用 PowerShell/API 和 Azure Resource Manager 範本來部署具有 Microsoft 反惡意程式碼擴充功能的虛擬機器擴展集。若要在已執行中的虛擬機器上安裝擴充功能，您可以使用位於[這裡](https://github.com/gbowerman/vmsstools)的範例 python 指令碼「vmssextn.py」。此指令碼會取得擴展集上的現有擴充功能組態，並將擴充功能新增至 VM 擴展集上的現有擴充功能清單。

###預設和自訂的反惡意程式碼組態

當您未提供自訂組態設定時，可套用預設的組態設定以啟動適用於 Azure 雲端服務或虛擬機器的反惡意程式碼程式。預設組態設定已預先最佳化可在 Azure 環境中執行。或者，您可以依 Azure 應用程式或服務部署的需要來自訂這些預設組態設定，並將其套用至其他部署案例。

> [AZURE.NOTE] Azure Resource Manager 上的「Microsoft Antimalware 使用者介面」預設為停用，並不支援使用可略過此錯誤訊息的 [cleanuppolicy.xml](https://blogs.msdn.microsoft.com/azuresecurity/2016/02/24/update-on-microsoft-antimalware-and-azure-resource-manager-arm-vms/) 檔案。如需有關如何建立自訂原則的資訊，請參閱 [Enabling Microsoft Antimalware User Interface on Azure Resource Manager VMs Post Deployment (在部署後於 Azure Resource Manager VM 上啟用 Microsoft Antimalware 使用者介面)](https://blogs.msdn.microsoft.com/azuresecurity/2016/03/09/enabling-microsoft-antimalware-user-interface-post-deployment/)。

下表摘要說明反惡意程式碼服務可用的組態設定。預設的組態設定在下面標示為「預設」的資料行底下會有標記。

![表 1](./media/azure-security-antimalware/sec-azantimal-tb18.PNG)

##反惡意程式碼部署案例

本節將討論啟用及設定反惡意程式碼的案例，包括 Azure 雲端服務和虛擬機器的監視。

###虛擬機器 - 啟用和設定反惡意程式碼

**使用 Azure 入口網站進行部署**

若要啟用 Antimalware 服務，請按一下 [延伸模組] 刀鋒視窗上的 [新增]，選取 [新的資源] 刀鋒視窗上的 [Microsoft Antimalware]，按一下 [Microsoft Antimalware] 刀鋒視窗上的 [建立]。按一下 [建立] 且不輸入任何組態值，以預設設定來啟用 Antimalware，或如下方圖 2 所示針對設定的虛擬機器輸入 Antimalware 組態設定。請參閱 [新增延伸模組] 刀鋒視窗中，針對每一組態設定所提供的**工具提示**，來查看支援的組態值。

![Microsoft Antimalware 的虛擬機器組態設定](./media/azure-security-antimalware/sec-azantimal-fig2.PNG)

**使用 Azure 傳統入口網站進行部署**

若要在佈建「虛擬機器」時，使用 Azure 入口網站來啟用和設定「適用於 Azure 虛擬機器的 Microsoft Antimalware」，請依照下列步驟執行：

1\.登入 Azure 入口網站：<https://portal.azure.com>

2\.若要建立新的虛擬機器，請按一下 [新增]、[計算]、[虛擬機器]、[從資源庫] \(請勿使用 [快速建立])，如下所示：

![新虛擬機器](./media/azure-security-antimalware/sec-azantimal-fig3.PNG)


3\.選取 [選擇映像] 頁面上的 [Microsoft Windows Server] 映像。

4\.按一下向右箭號並輸入虛擬機器組態。

5\.核取 [虛擬機器組態] 頁面上 [安全性延伸模組] 下方的 [Microsoft Antimalware] 核取方塊。

6\.按一下 [提交] 按鈕，以使用預設的組態設定來啟用和設定適用於 Azure 虛擬機器的 Microsoft Antimalware。

![虛擬機器組態](./media/azure-security-antimalware/sec-azantimal-fig4.PNG)

**使用 Visual Studio 虛擬機器組態進行部署**

使用 Visual Studio 來啟用及設定 Microsoft Antimalware 服務：

1\.在 Visual Studio 中連接至 Microsoft Azure。

2\.在 [伺服器總管] 的 [虛擬機器] 節點中，選擇您的虛擬機器

![Visual Studio 中的虛擬機器組態](./media/azure-security-antimalware/sec-azantimal-fig5.PNG)

3\.以滑鼠右鍵按一下 [設定]，以檢視虛擬機器的組態頁面

4\.從 [已安裝的延伸模組] 下的下拉式清單中，選取 [Microsoft Antimalware] 延伸模組，並按一下 [新增] 以使用預設的反惡意程式碼組態來進行設定。

![已安裝的延伸模組](./media/azure-security-antimalware/sec-azantimal-fig6.PNG)

5\.若要自訂預設的反惡意程式碼組態，請在已安裝的延伸模組清單中選取 (反白顯示) 反惡意程式碼延伸模組，然後按一下 [設定]。

6\.在 [公用組態] 文字方塊中，使用自訂組態 (支援的 JSON 格式) 來取代預設的反惡意程式碼 組態，並按一下 [確定]。

7\.按一下 [更新] 按鈕，以將組態更新推送至虛擬機器。

![虛擬機器組態延伸模組](./media/azure-security-antimalware/sec-azantimal-fig7.PNG)

**注意：**適用於 Antimalware 的 Visual Studio 虛擬機器組態僅支援 JSON 格式設定。[適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware - 程式碼範例](http://aka.ms/amazsamples "適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware - 程式碼範例")一文中內含 Antimalware JSON 組態設定範本，其中顯示了支援的反惡意程式碼組態設定。

**使用 PowerShell Cmdlet 進行部署**

Azure 應用程式或服務可使用 PowerShell Cmdlet 來啟用或設定適用於 Azure 虛擬機器的 Microsoft Antimalware。

若要使用反惡意程式碼 PowerShell Cmdlet 啟用及設定 Microsoft Antimalware：

1. 設定您的 PowerShell 環境 - 請參考下文，網址為 <https://github.com/Azure/azure-powershell>

2. 使用 Set-AzureVMMicrosoftAntimalwareExtension Antimalware Cmdlet 來啟用和設定適用於虛擬機器的 Microsoft Antimalware，如下文所記載，網址為 <http://msdn.microsoft.com/library/azure/dn771718.aspx>

**注意：**適用於 Antimalware 的 Azure 虛擬機器組態僅支援 JSON 格式設定。[適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware - 程式碼範例](http://aka.ms/amazsamples "適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware - 程式碼範例")一文中內含 Antimalware JSON 組態設定範本，其中顯示了支援的反惡意程式碼組態設定。

###使用 PowerShell Cmdlet 來啟用和設定 Antimalware

Azure 應用程式或服務可使用 PowerShell Cmdlet 來啟用或設定適用於 Azure 雲端服務的 Microsoft Antimalware。請注意 Microsoft Antimalware 是以停用狀態安裝在雲端服務平台中，且需要 Azure 應用程式執行動作來啟用它。

若要使用 PowerShell Cmdlet 來啟用和設定 Microsoft Antimalware：

1.  設定您的 PowerShell 環境 - 請參考下文，網址為 <https://github.com/Azure/azure-sdk-tools#get-started>

2.  使用 Set-AzureServiceAntimalwareExtension Antimalware Cmdlet 來啟用和設定適用於雲端服務的 Microsoft Antimalware，如下文所記載，網址為 <http://msdn.microsoft.com/library/azure/dn771718.aspx>

[適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware - 程式碼範例](http://aka.ms/amazsamples "適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware - 程式碼範例")一文中內含 Antimalware XML 組態設定範本，其中顯示了支援的反惡意程式碼組態設定。

###雲端服務和虛擬機器 - 使用 PowerShell Cmdlet 進行設定

Azure 應用程式或服務可使用 PowerShell Cmdlet 來擷取適用於雲端服務和虛擬機器的 Microsoft Antimalware 組態。

若要使用 PowerShell Cmdlet 來擷取 Microsoft Antimalware 組態：

1.  設定您的 PowerShell 環境 - 請參考下文，網址為 <https://github.com/Azure/azure-sdk-tools#get-started>

2.  **針對虛擬機器**：請使用 Get-AzureVMMicrosoftAntimalwareExtension Antimalware Cmdlet 來取得反惡意程式碼組態，如下文所記載，網址為 <http://msdn.microsoft.com/library/azure/dn771719.aspx>

3.  **針對雲端服務**：請使用 Get-AzureServiceAntimalwareConfig Antimalware cmdlet 來取得反惡意程式碼組態，如下文所記載，網址為 <http://msdn.microsoft.com/library/azure/dn771722.aspx>

###使用 PowerShell Cmdlet 來移除 Antimalware 組態

Azure 應用程式或服務可從相關的 Azure Antimalware 以及與「雲端服務」或「虛擬機器」關聯的診斷服務延伸模組中，移除 Antimalware 組態和任何關聯的 Antimalware 監視組態。

若要使用 PowerShell Cmdlet 來移除 Microsoft Antimalware：

1.  設定您的 PowerShell 環境 - 請參考下文，網址為 <https://github.com/Azure/azure-sdk-tools#get-started>

2.  **針對虛擬機器**：請使用 Remove-AzureVMMicrosoftAntimalwareExtension Antimalware Cmdlet，如下文所記載，網址為 <http://msdn.microsoft.com/library/azure/dn771720.aspx>

3.  **針對雲端服務**：請使用 Remove-AzureServiceAntimalwareExtension Antimalware Cmdlet，如下文所記載，網址為 <http://msdn.microsoft.com/library/azure/dn771717.aspx>

若要使用 Azure Preview 入口網站來**啟用**適用於虛擬機器的反惡意程式碼事件集合：

1.  按一下 [虛擬機器] 刀鋒視窗中 [監視] 濾鏡的任何部分

2.  按一下 [度量] 刀鋒視窗中的 [診斷] 命令

3.  將 [狀態] 選取為 [開啟]，並勾選 Windows 事件系統的選項
4.  。您可以選擇取消勾選清單中的所有其他選項，或是依每個應用程式服務的需要維持啟用狀態。

4.  「錯誤」、「警告」、「資訊性」等反惡意程式碼事件類別都會擷取在 Azure 儲存體帳戶中。

反惡意程式碼事件是從 Windows 事件系統記錄檔收集至您的 Azure 儲存體帳戶中。您可以藉由選取適當的儲存體帳戶，為您的虛擬機器設定儲存體帳戶以收集反惡意程式碼事件。

![度量和診斷](./media/azure-security-antimalware/sec-azantimal-fig8.PNG)

> [AZURE.NOTE] 如需有關如何為 Azure Antimalware 啟用「診斷記錄」的詳細資訊，請參閱 [Enabling Diagnostics Logging for Azure Antimalware (為 Azure Antimalware 啟用診斷記錄)](https://blogs.msdn.microsoft.com/azuresecurity/2016/04/19/enabling-diagnostics-logging-for-azure-antimalware/)。

###使用 PowerShell Cmdlet 來啟用和設定 Antimalware 監視

您可以透過 Antimalware PowerShell cmdlet 使用 Azure 診斷來啟用雲端服務或虛擬機器的 Microsoft Antimalware 事件集合。您可以設定 Azure 診斷程式延伸模組，以從系統事件記錄檔來源 Microsoft Antimalware 擷取事件至 Azure 儲存體帳戶。「錯誤」、「警告」、「資訊性」等反惡意程式碼事件類別都會擷取在 Azure 儲存體帳戶中。

若要使用 PowerShell cmdlet 在 Azure 儲存體帳戶中啟用反惡意程式碼事件集合：

1.  設定您的 PowerShell 環境 - 請參閱 <https://github.com/Azure/azure-sdk-tools#get-started>

2.  **針對虛擬機器** - 請使用 Set-AzureVMMicrosoftAntimalwareExtension Antimalware Cmdlet 與 [監視啟用] 選項，如下文所記載，網址為 <http://msdn.microsoft.com/library/azure/dn771716.aspx>

3.  **針對雲端服務** - 請使用 Set-AzureServiceAntimalwareExtension Antimalware Cmdlet 與 [監視啟用] 選項，如下文所記載，網址為 <http://msdn.microsoft.com/library/azure/dn771718.aspx>

您可以藉由查看 Azure 儲存體帳戶 (已設定來啟用反惡意程式碼監視) 中的 WADWindowsEventLogsTable 資料表來檢視 Antimalware 的原始事件。這可有效地驗證反惡意程式碼事件集合是否正常運作，包括深入了解反惡意程式碼服務的健康狀態。如需詳細資訊，包括有關如何從儲存體帳戶擷取反惡意程式碼事件的範例程式碼，請參閱 [適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware - 程式碼範例](http://aka.ms/amazsamples "適用於 Azure 雲端服務和虛擬機器的 Microsoft Antimalware - 程式碼範例")。

<!---HONumber=AcomDC_0921_2016-->